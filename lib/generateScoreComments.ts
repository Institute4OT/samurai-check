// lib/generateScoreComments.ts
import type { CategoryScores } from './scoringSystem';

// ãƒãƒ³ãƒ‰å¢ƒç•Œï¼ˆ0ã€œ3ç‚¹ã‚¹ã‚±ãƒ¼ãƒ«ï¼‰
const HIGH = 2.4; // ã“ã‚Œä»¥ä¸Šã¯ã€Œå¼·ã¿ã€ã‚³ãƒ¡ãƒ³ãƒˆ
const LOW  = 1.6; // ã“ã‚Œæœªæº€ã¯ã€Œé‡è¦æ”¹å–„ã€ã€ä»¥ä¸Šã¯ã€Œè»½å¾®æ”¹å–„ã€

type CommentSet = {
  strength: string;   // HIGH ä»¥ä¸Š
  tip: string;        // LOW ä»¥ä¸Š HIGH æœªæº€ï¼ˆè»½å¾®æ”¹å–„ï¼‰
  tipSevere: string;  // LOW æœªæº€ï¼ˆé‡è¦æ”¹å–„ï¼‰
};

const COMMENTS: Record<keyof CategoryScores, CommentSet> = {
  'ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆåŠ›': {
    strength:
      'å¤‰åŒ–ã‚’æã‚Œãšã€å°ã•ãè©¦ã—ã¦æ•°å€¤ã§åˆ¤æ–­ã™ã‚‹å§¿å‹¢ãŒéš›ç«‹ã£ã¦ã„ã¾ã™ã€‚',
    tip:
      'å°ã•ãªå®Ÿé¨“ â†’ ãƒ‡ãƒ¼ã‚¿ã§è‰¯ã—æ‚ªã—ã‚’åˆ¤æ–­ã™ã‚‹ã‚µã‚¤ã‚¯ãƒ«ã‚’æ„è­˜ã—ã¦å›ã—ã¾ã—ã‚‡ã†ã€‚',
    tipSevere:
      'æ–°è¦ææ¡ˆã¯ã€Œæ‹…å½“è€…ã‚’æ±ºã‚ã¦å°ã•ãè©¦ã™ã€ã‚’æ¨™æº–åŒ–ã—ã€çµæœã§åˆ¤æ–­ã™ã‚‹é‹ç”¨ã¸åˆ‡ã‚Šæ›¿ãˆã¾ã—ã‚‡ã†ã€‚',
  },
  'ã‚³ãƒŸãƒ¥åŠ›èª¤å·®': {
    strength:
      'ç«‹å ´ã‚„ä¸–ä»£ã‚’è¶…ãˆã¦æ„å›³ãŒä¼ã‚ã‚Šã€ç¾å ´ã®ç†è§£ã‚‚å¾—ã‚‰ã‚Œã¦ã„ã¾ã™ã€‚',
    tip:
      'ãƒ“ã‚¸ãƒ§ãƒ³ã‚’â€œç¾å ´ã®è¡Œå‹•â€ã«ç¿»è¨³ã™ã‚‹å¯¾è©±ï¼ˆä¾‹ï¼šæœˆ1å›ã®æŒ¯ã‚Šè¿”ã‚Šãƒ»äº‹ä¾‹å…±æœ‰ï¼‰ã‚’ç¶šã‘ã¾ã—ã‚‡ã†ã€‚',
    tipSevere:
      'ãƒ“ã‚¸ãƒ§ãƒ³ã‚’ä½œã£ã¦çµ‚ã‚ã‚Šã«ã›ãšã€ç¾å ´ã¨ä¸€ç·’ã«ã€Œã©ã†æ´»ã‹ã™ã‹ã€ã‚’å¯¾è©±ã™ã‚‹å ´ã‚’å®šä¾‹åŒ–ã—ã¾ã—ã‚‡ã†ã€‚',
  },
  'ã‚¸ã‚§ãƒã‚®ãƒ£ãƒƒãƒ—æ„Ÿè¦š': {
    strength:
      'è‹¥æ‰‹ã®ä¾¡å€¤è¦³ã‚„åƒãæ–¹ã®å¤šæ§˜æ€§ã«æŸ”è»Ÿã«å¯¾å¿œã§ãã¦ã„ã¾ã™ã€‚',
    tip:
      'åƒãæ–¹ã®é¸æŠè‚¢ã‚„è¶Šå¢ƒå­¦ç¿’ã®æ©Ÿä¼šã‚’å¢—ã‚„ã—ã€ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€å¤§åŒ–ã‚’ç‹™ã„ã¾ã—ã‚‡ã†ã€‚',
    tipSevere:
      'ã€Œä»•äº‹ã¯ã“ã†ã‚ã‚‹ã¹ãã€ã¨ã„ã†å‰æã‚’è¦‹ç›´ã—ã€è‹¥æ‰‹ã®å£°ãƒ»é€€è·ç†ç”±ã®å®šç‚¹è¦³æ¸¬ã‚’å§‹ã‚ã¾ã—ã‚‡ã†ã€‚',
  },
  'çµ„ç¹”é€²åŒ–é˜»å®³': {
    strength:
      'ä»»ã›ã¦è©¦ã™æ–‡åŒ–ãŒã‚ã‚Šã€å¤‰åŒ–ã«å‰å‘ãã§ã™ã€‚',
    tip:
      'æ„æ€æ±ºå®šã¯ä¼šè­°ä½“ã§åˆæ„ â†’ æ‹…å½“ã¨æœŸé™ã‚’æ˜ç¢ºã«ã€‚ãƒˆãƒƒãƒ—ã®â€œæŒã¡å¸°ã‚Šä¿ç•™â€ã‚’æ¸›ã‚‰ã—ã¾ã—ã‚‡ã†ã€‚',
    tipSevere:
      'ãƒˆãƒƒãƒ—ä¸€å­˜ã‚„æ£šä¸Šã’ã‚’ã‚„ã‚ã€ã€Œæ‹…å½“ã‚’æ±ºã‚ã¦å°ã•ãè©¦ã™â†’ãƒ¬ãƒ“ãƒ¥ãƒ¼ã€ã‚’æ¨™æº–ãƒ—ãƒ­ã‚»ã‚¹ã«ã—ã¾ã—ã‚‡ã†ã€‚',
  },
  'ç„¡è‡ªè¦šãƒãƒ©ã‚¹ãƒ¡ãƒ³ãƒˆå‚¾å‘': {
    strength:
      'å¢ƒç•Œç·šã¸ã®é…æ…®ãŒã‚ã‚Šã€å®‰å¿ƒã—ã¦è©±ã›ã‚‹åœŸå£ŒãŒä½œã‚Œã¦ã„ã¾ã™ã€‚',
    tip:
      'å±æ€§è©±é¡Œã¯åŒæ„ãƒ™ãƒ¼ã‚¹ã§æ‰±ã†é‹ç”¨ã«ã€‚NGã‚¬ã‚¤ãƒ‰ã‚’ç°¡æ½”ã«æ–‡æ›¸åŒ–ã—ã€å½¹è·è€…ã«å‘¨çŸ¥ã—ã¾ã—ã‚‡ã†ã€‚',
    tipSevere:
      'å¤–éƒ¨/åŒ¿åã®ç›¸è«‡çª“å£ãƒ»å½¹è·è€…ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ã‚’æ€¥ãæ•´å‚™ã€‚æœè£…è¦å®šã‚„è©•ä¾¡åŸºæº–ã®ä¸­ç«‹åŒ–ã‚‚è¦‹ç›´ã—ã¾ã—ã‚‡ã†ã€‚',
  },
  'æ¨©é™å§”è­²ãƒ»æ§‹é€ å¥å…¨åº¦': {
    strength:
      'å½¹å‰²ãƒ»æ¨©é™ãƒ»æ±ºè£ãŒæ˜ç¢ºã§ã€ç¾å ´ãŒè‡ªå¾‹çš„ã«å‹•ã‘ã¦ã„ã¾ã™ã€‚',
    tip:
      'æ±ºè£åŸºæº–ã¨åˆæ„ãƒ—ãƒ­ã‚»ã‚¹ã®è¦‹ãˆã‚‹åŒ–ã€ä¼šè­°ã§ã®ã€Œæ‹…å½“ã¨æœŸæ—¥ã€æ˜ç¢ºåŒ–ã‚’å¾¹åº•ã—ã¾ã—ã‚‡ã†ã€‚',
    tipSevere:
      'æ±ºè£ã®å±äººåŒ–ã‚’è§£æ¶ˆã€‚ã€Œä¼šè­°ã§æ±ºã‚ã¦ä»»ã›ã‚‹ã€é‹ç”¨ã«åˆ‡æ›¿ãˆã€ç¤¾é•·æ‰¿èªã®ãƒœãƒˆãƒ«ãƒãƒƒã‚¯ã‚’å¤–ã—ã¾ã—ã‚‡ã†ã€‚',
  },
};

export function generateScoreComments(scores: CategoryScores): {
  strengths: string[];
  tips: string[];
} {
  // ã‚¨ãƒ³ãƒˆãƒªåŒ–
  const entries = (Object.keys(scores) as (keyof CategoryScores)[])
    .map((k) => ({ key: k, val: scores[k] }));

  // Top2ï¼ˆé™é †ï¼‰/ Bottom2ï¼ˆæ˜‡é †ï¼‰ã‚’æŠ½å‡ºã€‚é‡è¤‡ã¯é¿ã‘ã‚‹
  const desc = [...entries].sort((a, b) => b.val - a.val);
  const asc  = [...entries].sort((a, b) => a.val - b.val);

  const topKeys = desc.slice(0, 2).map((e) => e.key);
  const bottomKeys = asc.filter((e) => !topKeys.includes(e.key)).slice(0, 2).map((e) => e.key);

  // å¼·ã¿ï¼ˆTop2ï¼‰
  const strengths = topKeys.map((k) => {
    const v = scores[k];
    const c = COMMENTS[k];
    // HIGHæœªæº€ã§ã‚‚ã€ç°¡æ˜“çµæœã§ã¯å‰å‘ãã«è¦ç‚¹æç¤ºï¼ˆç›¸å¯¾çš„ã«é«˜ã„æ—¨ + è»½å¾®æ”¹å–„ãƒ’ãƒ³ãƒˆï¼‰
    if (v >= HIGH) return `âœ… ${c.strength}`;
    return `âœ… ã“ã®é ˜åŸŸã¯ç›¸å¯¾çš„ã«é«˜ã‚ã§ã™ã€‚${c.tip}`;
  });

  // æ”¹å–„ï¼ˆBottom2ï¼‰
  const tips = bottomKeys.map((k) => {
    const v = scores[k];
    const c = COMMENTS[k];
    if (v < LOW) return `âš ï¸ ${c.tipSevere}`;
    return `ğŸ’¡ ${c.tip}`;
  });

  return { strengths, tips };
}
